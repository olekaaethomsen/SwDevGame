<html>
  <body>
    <table>
      <tr><td><a href="javascript:init()">start</a></td></tr>
      <tr><td><div id="release"/></td></tr>
      <tr><td><div id="sprint"/></td></tr>
      <tr><td><div id="turn"/></td></tr>
      <tr><td><div id="action"/></td></tr>
      <tr><td><div id="release"/></td></tr>
    </table>
  </body>
  <script>
    function init(){
      state = new GameState();
    }
    const numberOfTurnsInSprint = 3;
    const numberOfSprintsInRelease = 2;
    const numberOfReleases = 3;
    let state;
    class GameState{
      constructor(){
        this.players = [new Player("dev"), new Player("proj"), new Player("sales")];
        this.turnIndex = 0;
        this.startNextTurn();
      }
      startNextTurn(){
        console.log(`turn ${this.turnIndex}`);
        var player = this.players[this.turnIndex++ % this.players.length];
        this.currentTurn = new Turn(this, player);
      }
    }
    class Turn{
      constructor(state, player){
        this.state = state;
        this.play = player;
        this.actions = [
          new DrawCardAction(this.state, this.player),
          new EndTurnAction(this.state, this.player)
        ];
        this.actionIndex = 0;
        this.startNextAction();
      }
      startNextAction(){
        this.currentAction = this.actions[this.actionIndex++];
        this.currentAction.start();
      }
      endTurn(){ 
        this.state.startNextTurn();
      }
    }
    class Product{
      constructor(){
        this.releaseIndex = 0;
        this.sprintInReleaseIndex = 0;
        this.turnInSprintIndex =0;
      }
      startNewSprint(turnIndex){
        if(turnIndex%state.players.length == 0){
          this.turnInSprintIndex++;
        return turnInSprintIndex % numberOfTurnsInSprint == 0;
        }
      }
      startNewRelease(){
        if(this.sprintInReleaseIndex++ % numberOfSprintsInRelease)
        return  
      }

    }
    class Player{
      constructor(name){
        this.name = name;
      }
    }
    class Action{
      constructor(state, player){
        this.state = state;
        this.player = player;
      }
    }
    class PlanningAction extends Action{
      start(){
        document.getElementById("action").innerHTML = "<a href=\"javascript:state.currentTurn.currentAction.end()\">Start sprint</a>";
      }
    }
    class ReviewAction extends Action{
      start(){
        document.getElementById("action").innerHTML = "<a href=\"javascript:state.currentTurn.currentAction.end()\">Start sprint</a>";
      }
    }


    class EndTurnAction extends Action {
      start(){
        document.getElementById("action").innerHTML = "<a href=\"javascript:state.currentTurn.currentAction.end()\">end turn</a>";
      }
      end(){
        this.state.currentTurn.endTurn();
      }
    }
    class DrawCardAction extends Action {
      start(){
        document.getElementById("action").innerHTML = "<a href=\"javascript:state.currentTurn.currentAction.end()\">draw card</a>";
      }
      end(){
        this.state.currentTurn.startNextAction();
      }
    }
  </script>
</html>
